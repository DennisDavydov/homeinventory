<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Table</title>
    <style>
        td {
            text-align: center;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
</head>
<body style="background-color:#c7a7d1">

    <table id="productTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Amount(kg/l)</th>
                <th>Storage</th>
                <th>Expiration Date</th>
                <th>Barcode</th>
            </tr>
        </thead>
        <tbody>
            <% products.forEach(product => { %>
				<% if (product.expiry_date) { %> 
					<% const difference = (new Date(product.expiry_date) - new Date()) / (1000 * 60 * 60 * 24); %>
					<% const urgent = 2; %>
					<% const soon = 7; %>
					<% product.expiry_date = product.expiry_date.toLocaleDateString() %>
					
					<% if (difference <= urgent) { %>
						<tr style="background-color: red;">
					<% } else if (difference <= soon) { %>
						<tr style="background-color: yellow;">
					<% } else { %>
						<tr>
					<% } %>
				<% } else { %>
					<% product.expiry_date = "N/A" %>
					<tr>
					<% } %>
                    <td><%= product.name %></td>
                    <td><%= product.amount %></td>
                    <td><%= product.storage_place %></td>
                    <td style="font-weight:bold;"><%= product.expiry_type +":"+ product.expiry_date %></td>
                    <td><%= product.barcode %></td>
                </tr>
            <% }); %>
        </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/v/dt/dt-1.13.8/sb-1.6.0/datatables.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#productTable').DataTable({
            paging:false,
            //dom:'Qfrtip'
            });
        });
    </script>
</body>
</html>
